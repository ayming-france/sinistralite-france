<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Sinistralité France | Données ouvertes</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2032%2032'%3E%3Crect%20x='5'%20y='18'%20width='6'%20height='9'%20rx='1'%20fill='%23002395'/%3E%3Crect%20x='13'%20y='11'%20width='6'%20height='16'%20rx='1'%20fill='white'%20stroke='%23ccc'%20stroke-width='0.5'/%3E%3Crect%20x='21'%20y='5'%20width='6'%20height='22'%20rx='1'%20fill='%23ED2939'/%3E%3C/svg%3E">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link rel="stylesheet" href="styles/base.css">
<link rel="stylesheet" href="styles/nav.css">
<link rel="stylesheet" href="styles/search.css">
<link rel="stylesheet" href="styles/kpi.css">
<link rel="stylesheet" href="styles/charts.css">
<link rel="stylesheet" href="styles/drawers.css">
</head>
<body>

<a href="#main-content" class="skip-link">Aller au contenu principal</a>

<!-- Top nav bar -->
<nav class="top-nav">
  <a href="landing.html" class="top-nav-logo" aria-label="Retourner à l'accueil Sinistralité France" style="display:flex;align-items:center;gap:8px;text-decoration:none"><svg width="20" height="20" viewBox="0 0 32 32" style="flex-shrink:0" aria-hidden="true"><rect x="5" y="18" width="6" height="9" rx="1" fill="#002395"/><rect x="13" y="11" width="6" height="16" rx="1" fill="white" stroke="#ccc" stroke-width="0.5"/><rect x="21" y="5" width="6" height="22" rx="1" fill="#ED2939"/></svg><span style="font-weight:700;font-size:1rem;color:var(--text)">Sinistralité France</span></a>
  <div class="top-nav-right">
    <button class="theme-toggle" id="themeToggle" aria-label="Changer le thème">
      <i data-lucide="sun" class="icon-sun"></i>
      <i data-lucide="moon" class="icon-moon"></i>
    </button>
  </div>
</nav>

<!-- Nav rail (GA4-style) -->
<nav class="nav-rail" id="navRail">
  <div class="nav-items">
    <button class="nav-item active" data-view="at" aria-label="Accidents du Travail">
      <span class="nav-icon-wrap"><i data-lucide="hard-hat"></i></span>
      <span class="nav-label">Accidents du Travail</span>
    </button>
    <button class="nav-item" data-view="mp" aria-label="Maladies Professionnelles">
      <span class="nav-icon-wrap"><i data-lucide="thermometer"></i></span>
      <span class="nav-label">Maladies Pro.</span>
    </button>
    <button class="nav-item" data-view="trajet" aria-label="Accidents de Trajet">
      <span class="nav-icon-wrap"><i data-lucide="car"></i></span>
      <span class="nav-label">Trajet</span>
    </button>
    <div class="nav-divider"></div>
    <button class="nav-item disabled" data-view="overview" aria-label="Vue d'ensemble (bientôt disponible)">
      <span class="nav-icon-wrap"><i data-lucide="layout-dashboard"></i></span>
      <span class="nav-label">Vue d'ensemble</span>
      <span class="nav-badge">bientôt</span>
    </button>
  </div>
</nav>

<div class="container" id="main-content" tabindex="-1">

  <div class="loading-skeleton" id="loadingSkeleton">
    <div class="skeleton-header">
      <div class="skeleton-line skeleton-title"></div>
      <div class="skeleton-line skeleton-subtitle"></div>
    </div>
    <div class="skeleton-kpi-grid">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
    <div class="skeleton-charts">
      <div class="skeleton-chart-card"></div>
      <div class="skeleton-chart-card"></div>
    </div>
  </div>

  <div class="error-state" id="errorState" style="display:none">
    <div class="error-content">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      <h2>Erreur de chargement</h2>
      <p id="errorMessage">Impossible de charger les données.</p>
      <button class="retry-btn" id="retryBtn">Réessayer</button>
    </div>
  </div>

  <header>
    <div class="header-eyebrow" id="headerEyebrow">Ameli Open Data 2023</div>
    <h1 id="headerTitle">Accidents du Travail par Secteur</h1>
    <p id="headerSubtitle">Statistiques de sinistralité par code NAF. Sélectionnez un secteur pour commencer.</p>
  </header>

  <!-- AT VIEW -->
  <div class="view active" id="view-at">
    <div class="search-section">
      <div class="search-row">
        <div class="search-wrapper">
          <span class="icon">/</span>
          <input type="text" id="at-searchInput" aria-label="Rechercher un secteur par code NAF ou mot-clé" placeholder="Tapez un code NAF ou un mot-clé pour explorer un secteur..." autocomplete="off">
          <div class="level-tabs" id="at-levelTabs">
            <button data-level="naf2" class="active" aria-label="Niveau NAF 2">NAF2</button>
            <button data-level="naf4" aria-label="Niveau NAF 4">NAF4</button>
            <button data-level="naf5" aria-label="Niveau NAF 5 (complet)">NAF</button>
          </div>
          <div class="autocomplete" id="at-autocomplete"></div>
        </div>
        <div class="action-icons">
          <button class="action-btn" id="shareBtn" aria-label="Partager" aria-expanded="false" data-tip="Partager"><i data-lucide="share-2"></i></button>
          <button class="action-btn" id="insightsBtn" aria-label="Afficher les insights" aria-expanded="false" data-tip="Insights"><i data-lucide="sparkles"></i><span class="notif-badge" id="insightsBadge"></span></button>
        </div>
      </div>
    </div>

    <div class="empty-state" id="at-emptyState">
      <div class="empty-inner">
        <div class="national-state" id="at-nationalState"></div>
      </div>
    </div>

    <div class="results-section" id="at-results">
      <div class="selection-header">
        <div class="breadcrumb" id="at-breadcrumb"></div>
        <h2 id="at-selTitle"></h2>
        <div class="sub" id="at-selSub"></div>
      </div>
      <div class="kpi-grid" id="at-kpiGrid"></div>
      <div class="comparison-card" id="at-compCard">
        <div class="comp-header">
          <h3 id="at-compTitle">Comparaison</h3>
          <div class="comp-toggle" id="at-compToggle">
            <button class="active" data-mode="chart" aria-label="Afficher en graphique"><i data-lucide="bar-chart-3"></i></button>
            <button data-mode="table" aria-label="Afficher en tableau"><i data-lucide="list"></i></button>
          </div>
        </div>
        <div class="chart-wrap" id="at-compWrap" style="height:320px"><canvas id="at-compChart"></canvas></div>
        <div class="comp-table-wrap" id="at-compTable"></div>
      </div>
      <div class="position-card" id="at-positionCard">
        <h3 id="at-posTitle">Positionnement IF</h3>
        <div class="pos-strip-wrap" id="at-posStrip"></div>
      </div>
      <div class="charts-row">
        <div class="chart-card">
          <h3>Causes d'accidents</h3>
          <div class="chart-wrap" id="at-causesWrap" style="height:320px"><canvas id="at-causesChart"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Cascade de sévérité</h3>
          <div id="at-funnelWrap"></div>
        </div>
      </div>
      <div class="evo-section" id="at-evoSection" style="display:none">
        <h3 class="evo-title">Évolution 2019 - 2023</h3>
        <div class="evo-grid">
          <div class="evo-card"><div class="evo-chart-wrap"><canvas id="at-evoEvents"></canvas></div></div>
          <div class="evo-card"><div class="evo-chart-wrap"><canvas id="at-evoIF"></canvas></div></div>
        </div>
      </div>
      <div class="demo-section" id="at-demoSection" style="display:none">
        <h3 class="evo-title">Démographie des AT</h3>
        <div class="demo-grid">
          <div class="demo-card"><div class="demo-chart-wrap"><canvas id="at-demoSex"></canvas></div></div>
          <div class="demo-card"><div class="demo-chart-wrap"><canvas id="at-demoAge"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MP VIEW -->
  <div class="view" id="view-mp">
    <div class="search-section">
      <div class="search-row">
        <div class="search-wrapper">
          <span class="icon">/</span>
          <input type="text" id="mp-searchInput" aria-label="Rechercher un secteur par code NAF ou mot-clé" placeholder="Tapez un code NAF ou un mot-clé pour explorer un secteur..." autocomplete="off">
          <div class="level-tabs" id="mp-levelTabs">
            <button data-level="naf2" class="active" aria-label="Niveau NAF 2">NAF2</button>
            <button data-level="naf4" aria-label="Niveau NAF 4">NAF4</button>
            <button data-level="naf5" aria-label="Niveau NAF 5 (complet)">NAF</button>
          </div>
          <div class="autocomplete" id="mp-autocomplete"></div>
        </div>
        <div class="action-icons">
          <button class="action-btn" id="mp-shareBtn" aria-label="Partager" aria-expanded="false" data-tip="Partager"><i data-lucide="share-2"></i></button>
          <button class="action-btn" id="mp-insightsBtn" aria-label="Afficher les insights" aria-expanded="false" data-tip="Insights"><i data-lucide="sparkles"></i><span class="notif-badge" id="mp-insightsBadge"></span></button>
        </div>
      </div>
    </div>

    <div class="empty-state" id="mp-emptyState">
      <div class="empty-inner">
        <div class="national-state" id="mp-nationalState"></div>
      </div>
    </div>

    <div class="results-section" id="mp-results">
      <div class="selection-header">
        <div class="breadcrumb" id="mp-breadcrumb"></div>
        <h2 id="mp-selTitle"></h2>
        <div class="sub" id="mp-selSub"></div>
      </div>
      <div class="kpi-grid" id="mp-kpiGrid"></div>
      <div class="comparison-card" id="mp-compCard">
        <div class="comp-header">
          <h3 id="mp-compTitle">Comparaison</h3>
          <div class="comp-toggle" id="mp-compToggle">
            <button class="active" data-mode="chart" aria-label="Afficher en graphique"><i data-lucide="bar-chart-3"></i></button>
            <button data-mode="table" aria-label="Afficher en tableau"><i data-lucide="list"></i></button>
          </div>
        </div>
        <div class="chart-wrap" id="mp-compWrap" style="height:320px"><canvas id="mp-compChart"></canvas></div>
        <div class="comp-table-wrap" id="mp-compTable"></div>
      </div>
      <div class="position-card" id="mp-positionCard">
        <h3 id="mp-posTitle">Positionnement IF</h3>
        <div class="pos-strip-wrap" id="mp-posStrip"></div>
      </div>
      <div class="charts-row">
        <div class="chart-card">
          <h3>Types de maladies</h3>
          <div class="chart-wrap" id="mp-causesWrap" style="height:320px"><canvas id="mp-causesChart"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Cascade de sévérité</h3>
          <div id="mp-funnelWrap"></div>
        </div>
      </div>
      <div class="evo-section" id="mp-evoSection" style="display:none">
        <h3 class="evo-title">Évolution 2019 - 2023</h3>
        <div class="evo-grid">
          <div class="evo-card"><div class="evo-chart-wrap"><canvas id="mp-evoEvents"></canvas></div></div>
          <div class="evo-card"><div class="evo-chart-wrap"><canvas id="mp-evoIF"></canvas></div></div>
        </div>
      </div>
      <div class="demo-section" id="mp-demoSection" style="display:none">
        <h3 class="evo-title">Démographie des MP</h3>
        <div class="demo-grid">
          <div class="demo-card"><div class="demo-chart-wrap"><canvas id="mp-demoSex"></canvas></div></div>
          <div class="demo-card"><div class="demo-chart-wrap"><canvas id="mp-demoAge"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- TRAJET VIEW -->
  <div class="view" id="view-trajet">
    <div class="search-section">
      <div class="search-row">
        <div class="search-wrapper">
          <span class="icon">/</span>
          <input type="text" id="trajet-searchInput" aria-label="Rechercher un secteur par code NAF ou mot-clé" placeholder="Tapez un code NAF ou un mot-clé pour explorer un secteur..." autocomplete="off">
          <div class="level-tabs" id="trajet-levelTabs">
            <button data-level="naf2" class="active" aria-label="Niveau NAF 2">NAF2</button>
            <button data-level="naf4" aria-label="Niveau NAF 4">NAF4</button>
            <button data-level="naf5" aria-label="Niveau NAF 5 (complet)">NAF</button>
          </div>
          <div class="autocomplete" id="trajet-autocomplete"></div>
        </div>
        <div class="action-icons">
          <button class="action-btn" id="trajet-shareBtn" aria-label="Partager" aria-expanded="false" data-tip="Partager"><i data-lucide="share-2"></i></button>
          <button class="action-btn" id="trajet-insightsBtn" aria-label="Afficher les insights" aria-expanded="false" data-tip="Insights"><i data-lucide="sparkles"></i><span class="notif-badge" id="trajet-insightsBadge"></span></button>
        </div>
      </div>
    </div>

    <div class="empty-state" id="trajet-emptyState">
      <div class="empty-inner">
        <div class="national-state" id="trajet-nationalState"></div>
      </div>
    </div>

    <div class="results-section" id="trajet-results">
      <div class="selection-header">
        <div class="breadcrumb" id="trajet-breadcrumb"></div>
        <h2 id="trajet-selTitle"></h2>
        <div class="sub" id="trajet-selSub"></div>
      </div>
      <div class="kpi-grid" id="trajet-kpiGrid"></div>
      <div class="comparison-card" id="trajet-compCard">
        <div class="comp-header">
          <h3 id="trajet-compTitle">Comparaison</h3>
          <div class="comp-toggle" id="trajet-compToggle">
            <button class="active" data-mode="chart" aria-label="Afficher en graphique"><i data-lucide="bar-chart-3"></i></button>
            <button data-mode="table" aria-label="Afficher en tableau"><i data-lucide="list"></i></button>
          </div>
        </div>
        <div class="chart-wrap" id="trajet-compWrap" style="height:320px"><canvas id="trajet-compChart"></canvas></div>
        <div class="comp-table-wrap" id="trajet-compTable"></div>
      </div>
      <div class="position-card" id="trajet-positionCard">
        <h3 id="trajet-posTitle">Positionnement IF</h3>
        <div class="pos-strip-wrap" id="trajet-posStrip"></div>
      </div>
      <div class="charts-row">
        <div class="chart-card" id="trajet-evoSection" style="display:none">
          <h3>Évolution 2019 - 2023</h3>
          <div class="evo-chart-wrap"><canvas id="trajet-evoEvents"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Cascade de sévérité</h3>
          <div id="trajet-funnelWrap"></div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <span id="footerSource">Source : <a href="https://www.data.gouv.fr" target="_blank">data.gouv.fr, données ouvertes</a></span>
    <span id="footerStats"></span>
  </footer>
</div>

<!-- Shared drawers (outside .container to avoid stacking context) -->
<div class="insights-drawer" id="insightsDrawer" role="dialog" aria-modal="true" aria-label="Insights">
  <div class="insights-drawer-header">
    <span class="drawer-icon"><i data-lucide="sparkles"></i></span>
    <h3>Insights</h3>
    <button class="close-btn" id="insightsCloseBtn" aria-label="Fermer les insights" title="Fermer">&times;</button>
  </div>
  <div class="insights-drawer-sub" id="drawerSub">Sélectionnez un secteur</div>
  <div class="insights-drawer-body" id="drawerBody" aria-live="polite">
    <div class="insights-drawer-empty">Sélectionnez un secteur pour<br>afficher les insights.</div>
  </div>
</div>

<div class="share-drawer" id="shareDrawer" role="dialog" aria-modal="true" aria-label="Partager">
  <div class="share-drawer-header">
    <span class="drawer-icon"><i data-lucide="share-2"></i></span>
    <h3>Partager</h3>
    <button class="close-btn" id="shareCloseBtn" aria-label="Fermer le partage" title="Fermer">&times;</button>
  </div>
  <div class="share-drawer-body">
    <button class="share-option" id="copyLinkBtn">
      <span class="share-option-icon">&#x1F517;</span>
      <span class="share-option-label">Copier le lien</span>
      <span class="share-option-arrow">&#x203A;</span>
    </button>
    <button class="share-option" id="downloadCSVBtn" disabled aria-disabled="true" aria-label="Télécharger les données du secteur en CSV">
      <span class="share-option-icon">&#x2193;</span>
      <span class="share-option-label">Télécharger CSV</span>
      <span class="share-option-arrow">&#x203A;</span>
    </button>
  </div>
</div>

<nav class="bottom-nav" id="bottomNav" aria-label="Navigation mobile">
  <button class="nav-item bottom-nav-item active" data-view="at" aria-label="Accidents du Travail">
    <span class="nav-icon-wrap"><i data-lucide="hard-hat"></i></span>
    <span class="bottom-nav-label">AT</span>
  </button>
  <button class="nav-item bottom-nav-item" data-view="mp" aria-label="Maladies Professionnelles">
    <span class="nav-icon-wrap"><i data-lucide="thermometer"></i></span>
    <span class="bottom-nav-label">MP</span>
  </button>
  <button class="nav-item bottom-nav-item" data-view="trajet" aria-label="Accidents de Trajet">
    <span class="nav-icon-wrap"><i data-lucide="car"></i></span>
    <span class="bottom-nav-label">Trajet</span>
  </button>
</nav>

<script type="module" src="js/app.js"></script>
</body>
</html>
