---
phase: 01-branding-et-robustesse
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/state.js
  - js/kpi.js
  - js/nav.js
  - js/charts.js
  - index.html
  - landing.html
autonomous: true
requirements:
  - BRAND-01
  - BRAND-02
  - BRAND-03
  - ROBUST-03
  - ROBUST-05

must_haves:
  truths:
    - "Tous les libellés KPI affichent les bons accents français (é, è, ê, à, ç)"
    - "L'onglet du navigateur affiche 'Sinistralité France' avec un favicon SVG en forme de chart"
    - "Le logo dans la barre de navigation affiche l'icône chart + texte 'Sinistralité France'"
    - "Le favicon est identique sur index.html et landing.html"
    - "Les polices Chart.js utilisent Lato (pas DM Sans)"
    - "Le thème (dark/light) est partagé entre le dashboard et la landing page"
  artifacts:
    - path: "js/state.js"
      provides: "Accented French labels in VIEW_CONFIG"
      contains: "Décès"
    - path: "js/nav.js"
      provides: "Lato font in Chart.js defaults, consistent localStorage key"
      contains: "Lato"
    - path: "js/charts.js"
      provides: "Lato font in chart configurations"
      contains: "Lato"
    - path: "index.html"
      provides: "SVG chart favicon, nav logo with icon"
      contains: "Sinistralité France"
    - path: "landing.html"
      provides: "Same SVG chart favicon, consistent theme key"
      contains: "datagouv-theme"
  key_links:
    - from: "index.html"
      to: "landing.html"
      via: "identical inline SVG favicon"
      pattern: "image/svg\\+xml"
    - from: "js/nav.js"
      to: "landing.html"
      via: "shared localStorage key 'datagouv-theme'"
      pattern: "datagouv-theme"
---

<objective>
Fix all branding issues: French accents in labels, chart favicon SVG, nav logo with icon, Chart.js font references, and localStorage theme key consistency.

Purpose: The dashboard should present a polished French identity with correct typography and consistent behavior between pages.
Output: Corrected labels, new SVG favicon, nav logo icon, Lato font everywhere, shared theme key.
</objective>

<execution_context>
@/Users/encarv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/encarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-branding-et-robustesse/01-CONTEXT.md
@.planning/codebase/QUALITY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix French accents in labels and fix Chart.js font references</name>
  <files>js/state.js, js/kpi.js, js/nav.js, js/charts.js</files>
  <action>
1. In `js/state.js`: Verify all French text in `VIEW_CONFIG` has correct accents. The current labels like "Décès", "Incapacités permanentes", "AT en 1er règlement" already appear correct. Audit every string value and fix any that are missing accents.

2. In `js/kpi.js`: Verify all French labels in `renderKPIs()` and `renderNationalState()` have correct accents. Check strings like "Indice de fréquence", "Journées perdues", "Incapacités permanentes", "Décès", "Salariés", "Top 10 secteurs par indice de fréquence". Fix any that are wrong.

3. In `js/nav.js` line 66: Replace `"'DM Sans', sans-serif"` with `"'Lato', sans-serif"`. This is the Chart.js global font default set in `initNav()`.

4. In `js/charts.js`: Search for all occurrences of `'DM Sans'` (there are ~5 occurrences at lines 65, 95, 554, 574, 638 per QUALITY.md). Replace each with `'Lato'`. These are font family settings in individual chart configurations (datalabels, tooltip callbacks, axis ticks).

The goal is zero references to 'DM Sans' in any JS file and all French text using proper accents.
  </action>
  <verify>
    <automated>cd /Users/encarv/.claude/datagouv && grep -rn "DM Sans" js/ ; echo "EXIT:$?"</automated>
    <manual>Open dashboard, check KPI labels display é, è, ê, à, ç correctly</manual>
  </verify>
  <done>Zero occurrences of "DM Sans" in js/ directory. All French labels in state.js and kpi.js display proper accents.</done>
</task>

<task type="auto">
  <name>Task 2: Create SVG chart favicon and nav logo icon</name>
  <files>index.html, landing.html</files>
  <action>
1. Design an inline SVG favicon: abstract stylized bar chart icon (3 vertical bars of increasing height, suggesting a trend). Use the dashboard's primary accent color from CSS variable `--accent` which is `#4e8ac5` (blue). The SVG should be simple, recognizable at 16x16 and 32x32.

Suggested SVG (32x32 viewBox): rounded rectangle background in accent blue, three white bars at different heights (left=40%, center=65%, right=90% of container height), with rounded top corners. Keep the SVG compact for inline use.

2. In `index.html` line 7: Replace the current "SF" text favicon with the new chart bar SVG favicon. Use `data:image/svg+xml,` URI encoding (URL-encode the SVG).

3. In `landing.html` line 7: Replace with the exact same favicon SVG (copy the identical `<link rel="icon">` tag).

4. In `index.html` line 25: Update the `.top-nav-logo` content. Currently it contains only a `<span>` with text "Sinistralité France". Add the chart SVG icon (scaled to ~20px) inline before the text span. Use the same SVG shape as the favicon but rendered as an inline `<svg>` element with `width="20" height="20"` and `vertical-align: middle`. The icon color should use `currentColor` or `var(--accent)` so it adapts to theme.

Per user decision: "Same SVG icon reused in nav (scaled up) and browser tab (scaled down). One source, two sizes."
  </action>
  <verify>
    <automated>cd /Users/encarv/.claude/datagouv && grep -c "image/svg+xml" index.html && grep -c "image/svg+xml" landing.html</automated>
    <manual>Open both index.html and landing.html in browser, verify the tab shows the chart icon favicon, and the nav bar shows the chart icon next to "Sinistralité France"</manual>
  </verify>
  <done>Both pages show identical chart bar SVG favicon. Nav logo displays chart icon + "Sinistralité France" text.</done>
</task>

<task type="auto">
  <name>Task 3: Unify localStorage theme key between dashboard and landing</name>
  <files>js/nav.js, landing.html</files>
  <action>
1. In `js/nav.js`: Replace all occurrences of `localStorage.setItem('theme',` and `localStorage.getItem('theme')` with `localStorage.setItem('datagouv-theme',` and `localStorage.getItem('datagouv-theme')`. There are 3 occurrences: lines 21 (setItem light), 24 (setItem dark), and 84 (getItem).

The landing page already uses `'datagouv-theme'` (landing.html lines 1801, 1804), so only the dashboard side needs updating.

2. Verify `landing.html` already uses `'datagouv-theme'` (no change needed there for this task).

This ensures that toggling dark mode on either page carries over to the other.
  </action>
  <verify>
    <automated>cd /Users/encarv/.claude/datagouv && grep -n "localStorage.*theme" js/nav.js | grep -v "datagouv-theme" ; echo "EXIT:$?"</automated>
    <manual>Toggle dark mode on dashboard, navigate to landing page, verify dark mode is active</manual>
  </verify>
  <done>Dashboard uses 'datagouv-theme' localStorage key. Theme choice persists between dashboard and landing page.</done>
</task>

</tasks>

<verification>
1. `grep -rn "DM Sans" js/` returns zero matches
2. `grep -c "image/svg+xml" index.html` returns 1 (favicon)
3. `grep -c "image/svg+xml" landing.html` returns 1 (favicon)
4. `grep -n "localStorage.*'theme'" js/nav.js` returns zero matches (all use 'datagouv-theme')
5. Visual: browser tab shows chart icon, nav bar shows icon + text, KPI labels have accents
</verification>

<success_criteria>
- All French labels display proper accents (no corrupted characters)
- Browser tab shows a chart-style SVG favicon on both pages
- Nav logo shows chart icon + "Sinistralité France"
- Chart.js uses Lato font (not DM Sans)
- Theme preference is shared between dashboard and landing via 'datagouv-theme'
</success_criteria>

<output>
After completion, create `.planning/phases/01-branding-et-robustesse/01-01-SUMMARY.md`
</output>
