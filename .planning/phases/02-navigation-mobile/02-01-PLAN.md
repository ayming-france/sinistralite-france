---
phase: 02-navigation-mobile
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - styles/nav.css
autonomous: false
requirements:
  - MOBILE-01
  - MOBILE-02

must_haves:
  truths:
    - "Sur un écran de 375px, une barre de navigation fixe en bas affiche 3 onglets AT, MP, Trajet"
    - "L'utilisateur peut basculer entre AT, MP et Trajet via les onglets du bottom bar"
    - "L'onglet actif est visuellement identifié par la couleur accent et une bordure supérieure"
    - "Au dessus de 768px, le bottom bar est masqué et le nav rail est affiché"
    - "L'item Vue d'ensemble est absent du bottom bar mobile"
  artifacts:
    - path: "index.html"
      provides: "Bottom nav HTML block with 3 nav-item buttons"
      contains: "bottom-nav"
    - path: "styles/nav.css"
      provides: "Bottom nav CSS rules with responsive show/hide"
      contains: ".bottom-nav"
  key_links:
    - from: "index.html (bottom-nav buttons)"
      to: "js/nav.js (initNav)"
      via: "Shared .nav-item[data-view] selector"
      pattern: "class=\"nav-item bottom-nav-item\""
    - from: "index.html (bottom-nav buttons)"
      to: "js/nav.js (switchView)"
      via: "Active class toggled on all .nav-item[data-view] elements"
      pattern: "classList.toggle.*active"
    - from: "styles/nav.css (.bottom-nav)"
      to: "styles/base.css (CSS custom properties)"
      via: "Theme tokens var(--bg-card), var(--accent), var(--border), var(--text-dim)"
      pattern: "var\\(--"
---

<objective>
Add a mobile bottom tab bar that lets users switch between AT, MP, and Trajet views on screens under 768px, while the desktop nav rail remains unchanged.

Purpose: The nav rail disappears below 768px (already width: 0), leaving mobile users with no way to switch views. A fixed bottom tab bar is the standard mobile pattern for 3 top-level destinations.

Output: Working bottom navigation with 3 tabs, responsive show/hide at 768px breakpoint, active state synced with nav rail.
</objective>

<execution_context>
@/Users/encarv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/encarv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation-mobile/02-RESEARCH.md
@index.html
@styles/nav.css
@js/nav.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bottom tab bar HTML and CSS</name>
  <files>index.html, styles/nav.css</files>
  <action>
**In index.html:**

Insert a `<nav class="bottom-nav" id="bottomNav" aria-label="Navigation mobile">` block immediately before the closing `</body>` tag (after all drawers and before the `<script>` tags). The block contains 3 buttons:

```html
<nav class="bottom-nav" id="bottomNav" aria-label="Navigation mobile">
  <button class="nav-item bottom-nav-item active" data-view="at" aria-label="Accidents du Travail">
    <span class="nav-icon-wrap"><i data-lucide="hard-hat"></i></span>
    <span class="bottom-nav-label">AT</span>
  </button>
  <button class="nav-item bottom-nav-item" data-view="mp" aria-label="Maladies Professionnelles">
    <span class="nav-icon-wrap"><i data-lucide="thermometer"></i></span>
    <span class="bottom-nav-label">MP</span>
  </button>
  <button class="nav-item bottom-nav-item" data-view="trajet" aria-label="Accidents de Trajet">
    <span class="nav-icon-wrap"><i data-lucide="car"></i></span>
    <span class="bottom-nav-label">Trajet</span>
  </button>
</nav>
```

Key details:
- Each button uses `class="nav-item bottom-nav-item"` so that `initNav()` in nav.js picks them up automatically via `document.querySelectorAll('.nav-item[data-view]')`. Zero JS changes needed.
- Use `bottom-nav-label` class (NOT `nav-label`) because nav rail CSS sets `.nav-label { opacity: 0 }` and only shows on hover. Bottom bar labels must always be visible.
- The AT button gets `active` class by default (matches `state.activeView = 'at'`).
- Lucide `data-lucide` icons will be rendered by the existing `lucide.createIcons()` call in `updateThemeUI()`.
- Do NOT include "Vue d'ensemble" in the bottom bar (hidden on mobile per user decision).

**In styles/nav.css:**

Append the following CSS rules at the end of the file:

```css
/* ── Bottom navigation bar (mobile only) ── */

.bottom-nav {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 100;
  height: 56px;
  background: var(--bg-card);
  border-top: 1px solid var(--border);
  flex-direction: row;
  align-items: stretch;
}

@media (max-width: 768px) {
  .bottom-nav {
    display: flex;
  }
}

.bottom-nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  height: 100%;
  padding: 0;
  border: none;
  border-top: 2px solid transparent;
  background: none;
  cursor: pointer;
  font-family: var(--sans);
  color: var(--text-dim);
  transition: color 0.15s, border-color 0.15s;
}

.bottom-nav-item:hover { color: var(--text); }
.bottom-nav-item.active { color: var(--accent); border-top-color: var(--accent); }
.bottom-nav-item.active .nav-icon-wrap { background: var(--accent-glow); }

.bottom-nav-item .nav-icon-wrap {
  background: none;
  border: none;
}

.bottom-nav-label {
  font-size: 0.65rem;
  font-weight: 600;
  letter-spacing: 0.02em;
  line-height: 1;
}
```

Key details:
- `z-index: 100` keeps bottom bar below drawers (which use z-index above 100).
- Use only CSS custom properties (var(--bg-card), var(--border), var(--accent), var(--text-dim), var(--accent-glow), var(--text)) so dark theme works automatically.
- The `.bottom-nav-item .nav-icon-wrap` rule resets the background/border that the nav rail icon wrap has, so icons display cleanly in the flat bottom bar style.
- The existing `.container` mobile media query already has `padding-bottom: 60px`, which provides clearance for the 56px bar.
  </action>
  <verify>
    <automated>grep -c "bottom-nav" index.html && grep -c ".bottom-nav" styles/nav.css</automated>
    <manual>Open index.html in a browser at 375px width. Bottom bar should appear with 3 tabs. Resize above 768px, bottom bar should disappear.</manual>
  </verify>
  <done>Bottom nav HTML exists in index.html with 3 buttons sharing .nav-item class. CSS in nav.css shows bottom bar below 768px and hides it above. Active state uses accent color with border-top indicator. Dark theme colors work via CSS custom properties.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify mobile navigation on multiple viewports</name>
  <action>
Human verification checkpoint. What was built: Bottom tab bar for mobile navigation between AT, MP, and Trajet views. The bar appears on screens under 768px, with Lucide icons, labels, and active state indicator. Desktop nav rail is unchanged.

Steps to verify:
1. Open `index.html` in a browser
2. Open DevTools and set viewport to 375x667 (iPhone SE)
3. Verify the bottom bar is visible with 3 tabs: AT (hard hat icon), MP (thermometer icon), Trajet (car icon)
4. Tap/click each tab. The view should switch and the active tab should show accent color + border-top
5. Switch between views and confirm the active indicator stays in sync
6. Resize viewport to 800px. The bottom bar should disappear and the nav rail should appear on the left
7. Toggle dark theme. The bottom bar should adapt (no white background or invisible text)
8. If a sector code is selected, switching views via bottom bar should work the same as via nav rail

Resume signal: Type "approved" or describe issues to fix.
  </action>
  <verify>
    <automated>grep -c "bottom-nav" index.html</automated>
    <manual>Visual verification on 375px and 800px viewports, dark/light themes, view switching</manual>
  </verify>
  <done>User has visually confirmed that the bottom tab bar works correctly on mobile viewports, switches views, shows active state, and adapts to dark theme.</done>
</task>

</tasks>

<verification>
1. At 375px viewport width, bottom tab bar is visible with 3 labeled tabs
2. Clicking each tab switches to the corresponding view (AT, MP, Trajet)
3. Active tab shows accent color and top border indicator
4. At 800px viewport width, bottom bar is hidden and nav rail is visible
5. Dark mode: bottom bar colors adapt correctly (no contrast issues)
6. "Vue d'ensemble" item does not appear in bottom bar
7. Drawers (Insights, Share) appear above the bottom bar (z-index correct)
</verification>

<success_criteria>
Mobile users on screens under 768px can navigate between AT, MP, and Trajet views using a fixed bottom tab bar with clear active state indication, while desktop users see the unchanged nav rail.
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-mobile/02-01-SUMMARY.md`
</output>
